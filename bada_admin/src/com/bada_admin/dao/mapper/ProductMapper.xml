<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProductMapper">
	<resultMap type="com.bada_admin.model.Product" id="product">
		<result property="id" column="id" />
		<result property="name" column="name" />
		<result property="list_price" column="list_price" />
		<result property="sale_price" column="sale_price" />
		<result property="book_img" column="book_img" />
		<result property="reg_date" column="reg_date" />
		<result property="edit_date" column="edit_date" />
		<result property="seller" column="seller" /> <!-- 판매자 : 회원="M", 바다="B" -->
		<result property="ok_status" column="ok_status" /> <!-- 승인 상태 : 승인="O", 승인대기="W", 거절="R" -->
		<result property="seller_id" column="seller_id" />
		<result property="seller_name" column="seller_name" />
		
	</resultMap>
	
	<!-- SELECT -->
	<!-- 상품 목록 조회 -->
	<select id="selectProductList" parameterType="com.bada_admin.model.Product" resultMap="product">
		SELECT
			p.id AS id, p.name AS name, p.list_price AS list_price, p.sale_price AS sale_price, p.book_img AS book_img,
			DATE_FORMAT(p.reg_date, '%Y-%m-%d') AS reg_date, DATE_FORMAT(p.edit_date, '%Y-%m-%d') AS edit_date, 
			p.seller AS seller, p.ok_status AS ok_status, p.seller_id AS seller_id, m.name AS seller_name
		FROM
			product p
		INNER JOIN
			member m
		ON
			p.seller_id=m.id
		ORDER BY
			id DESC
	</select>
	<!-- 상품 상세 조회 -->
	<select id="selectProduct" parameterType="com.bada_admin.model.Product" resultMap="product">
		SELECT
			p.id AS id, p.name AS name, p.list_price AS list_price, p.sale_price AS sale_price, p.book_img AS book_img,
			DATE_FORMAT(p.reg_date, '%Y-%m-%d') AS reg_date, DATE_FORMAT(p.edit_date, '%Y-%m-%d') AS edit_date, 
			p.seller AS seller, p.ok_status AS ok_status, p.seller_id AS seller_id, m.name AS seller_name
		FROM
			product p
		INNER JOIN
			member m
		ON
			p.seller_id=m.id
		WHERE
			id=#{id}
	</select>
	<!-- 총 상품 갯수 -->
	<select id="selectProductCount" parameterType="com.bada_admin.model.Product" resultType="int">
		SELECT
			COUNT(id)
		FROM
			product
	</select>
	
	<!-- INSERT -->
	<!-- 회원 상품 -->
	<insert id="insertProductMember" parameterType="com.bada_admin.model.Product" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO
			product(
				name, list_price, sale_price, book_img, reg_date, edit_date, seller, ok_status, seller_id	
			)
		VALUES(
			#{name}, #{list_price}, #{sale_price}, #{book_img}, now(), now(), 'M', 'W', #{seller_id}
		)
	</insert>
	<!-- 바다 상품 -->
	<insert id="insertProductBada" parameterType="com.bada_admin.model.Product" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO
			product(
				name, list_price, sale_price, book_img, reg_date, edit_date, seller, ok_status, seller_id	
			)
		VALUES(
			#{name}, #{list_price}, #{sale_price}, #{book_img}, now(), now(), 'B', 'O', #{seller_id}
		)
	</insert>
</mapper>